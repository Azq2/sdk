PROJECT := libc-1.0
TARGET := ANY
BUILD_TYPE := lib
BUILD_DIR := bin

CSTD := -std=gnu99
OPT := -Os

CFLAGS += -fomit-frame-pointer -Wno-implicit-fallthrough -Wno-missing-prototypes
DEFINES += -D__ARM_EABI__ -D__arm__
INCLUDES += -Isrc

LDLIBS += -lcrt_helper -lgcc-4.6.1

LDFLAGS += -Wl,--init=_init
LDFLAGS += -Wl,--fini=_fini

# reproductive builds
export SOURCE_DATE_EPOCH=1172750400
CFLAGS += -frandom-seed=0

# ASM sources
AFILES += src/errlist.S

# C sources
CFILES += main.c
CFILES += src/lib/assert_fail.c
CFILES += src/lib/atexit.c
CFILES += src/lib/atof.c
CFILES += src/lib/atol.c
CFILES += src/libc.c
CFILES += src/libc_init.c
CFILES += src/lib/closedir.c
CFILES += src/libcompat/mempcpy.c
CFILES += src/libcompat/stpcpy.c
CFILES += src/libcompat/stpncpy.c
CFILES += src/libcompat/strnlen.c
CFILES += src/libcompat/toascii.c
CFILES += src/libcruft/bindtextdomain.c
CFILES += src/libcruft/dcgettext.c
CFILES += src/libcruft/getopt_data.c
CFILES += src/libcruft/inet_ntoa.c
CFILES += src/libcruft/inet_ntoa_r.c
CFILES += src/libcruft/lc_ctype.c
CFILES += src/libcruft/localeconv.c
CFILES += src/libcruft/mkstemp.c
CFILES += src/libcruft/mktemp.c
CFILES += src/libcruft/nl_langinfo.c
CFILES += src/libcruft/setlocale.c
CFILES += src/libcruft/textdomain.c
CFILES += src/libcruft/tmpnam.c
CFILES += src/libdl/dlclose.c
CFILES += src/libdl/dlerror.c
CFILES += src/libdl/dlopen.c
CFILES += src/libdl/dlsym.c
CFILES += src/lib/__dtostr.c
CFILES += src/lib/errlistu.c
CFILES += src/lib/errno_location.c
CFILES += src/lib/getopt.c
CFILES += src/lib/isalnum.c
CFILES += src/lib/isalpha.c
CFILES += src/lib/isascii.c
CFILES += src/lib/isblank.c
CFILES += src/lib/isdigit.c
CFILES += src/lib/isgraph.c
CFILES += src/lib/__isinf.c
CFILES += src/lib/islower.c
CFILES += src/lib/isprint.c
CFILES += src/lib/ispunct.c
CFILES += src/lib/isspace.c
CFILES += src/lib/isupper.c
CFILES += src/lib/isxdigit.c
CFILES += src/lib/latin1-iscntrl.c
CFILES += src/lib/__lltostr.c
CFILES += src/lib/lseek64.c
CFILES += src/lib/__ltostr.c
CFILES += src/lib/memccpy.c
CFILES += src/lib/memchr.c
CFILES += src/lib/memcmp.c
CFILES += src/lib/memcpy.c
CFILES += src/lib/memmove.c
CFILES += src/lib/memset.c
CFILES += src/lib/opendir.c
CFILES += src/lib/perror.c
CFILES += src/lib/qsort.c
CFILES += src/lib/rand48.c
CFILES += src/lib/rand.c
CFILES += src/lib/rand_r.c
CFILES += src/lib/readdir.c
CFILES += src/lib/remove.c
CFILES += src/lib/rewind.c
CFILES += src/libshell/fnmatch.c
CFILES += src/lib/snprintf.c
CFILES += src/lib/sprintf.c
CFILES += src/lib/sscanf.c
CFILES += src/libstdio/clearerr.c
CFILES += src/libstdio/fclose.c
CFILES += src/libstdio/fdglue2.c
CFILES += src/libstdio/fdglue.c
CFILES += src/libstdio/fdopen.c
CFILES += src/libstdio/fdprintf.c
CFILES += src/libstdio/feof.c
CFILES += src/libstdio/ferror.c
CFILES += src/libstdio/fflush.c
CFILES += src/libstdio/fgetc_unlocked.c
CFILES += src/libstdio/fgetpos.c
CFILES += src/libstdio/fgets.c
CFILES += src/libstdio/fileno.c
CFILES += src/libstdio/fopen.c
CFILES += src/libstdio/fprintf.c
CFILES += src/libstdio/fputc_unlocked.c
CFILES += src/libstdio/fputs.c
CFILES += src/libstdio/fread.c
CFILES += src/libstdio/freopen.c
CFILES += src/libstdio/fscanf.c
CFILES += src/libstdio/fseek.c
CFILES += src/libstdio/fseeko64.c
CFILES += src/libstdio/fseeko.c
CFILES += src/libstdio/fsetopen.c
CFILES += src/libstdio/fsetpos.c
CFILES += src/libstdio/ftell.c
CFILES += src/libstdio/ftello64.c
CFILES += src/libstdio/ftello.c
CFILES += src/libstdio/fwrite.c
CFILES += src/libstdio/printf.c
CFILES += src/libstdio/putchar.c
CFILES += src/libstdio/puts.c
CFILES += src/libstdio/scanf.c
CFILES += src/libstdio/setvbuf.c
CFILES += src/libstdio/stderr.c
CFILES += src/libstdio/stdin.c
CFILES += src/libstdio/stdout.c
CFILES += src/libstdio/tmpfile.c
CFILES += src/libstdio/ungetc.c
CFILES += src/libstdio/vfdprintf.c
CFILES += src/libstdio/vfprintf.c
CFILES += src/libstdio/vfscanf.c
CFILES += src/libstdio/vprintf.c
CFILES += src/libstdio/vscanf.c
CFILES += src/lib/strcasecmp.c
CFILES += src/lib/strcat.c
CFILES += src/lib/strchr.c
CFILES += src/lib/strcmp.c
CFILES += src/lib/strcpy.c
CFILES += src/lib/strcspn.c
CFILES += src/lib/strdup.c
CFILES += src/lib/strerror.c
CFILES += src/lib/strlcat.c
CFILES += src/lib/strlcpy.c
CFILES += src/lib/strlen.c
CFILES += src/lib/strncasecmp.c
CFILES += src/lib/strncat.c
CFILES += src/lib/strncmp.c
CFILES += src/lib/strncpy.c
CFILES += src/lib/strpbrk.c
CFILES += src/lib/strrchr.c
CFILES += src/lib/strsep.c
CFILES += src/lib/strspn.c
CFILES += src/lib/strstr.c
CFILES += src/lib/strtod.c
CFILES += src/lib/strtof.c
CFILES += src/lib/strtok.c
CFILES += src/lib/strtok_r.c
CFILES += src/lib/strtol.c
CFILES += src/lib/strtold.c
CFILES += src/lib/strtoll.c
CFILES += src/lib/strtoul.c
CFILES += src/lib/strtoull.c
CFILES += src/lib/strxfrm.c
CFILES += src/lib/swab.c
CFILES += src/lib/tolower.c
CFILES += src/lib/toupper.c
CFILES += src/libugly/asctime.c
CFILES += src/libugly/difftime.c
CFILES += src/libugly/grantpt.c
CFILES += src/libugly/isleap.c
CFILES += src/libugly/localtime.c
CFILES += src/libugly/strftime.c
CFILES += src/libugly/strndup.c
CFILES += src/libugly/strptime.c
# CFILES += src/libugly/time64.c
CFILES += src/lib/uname.c
CFILES += src/lib/__v_printf.c
CFILES += src/lib/__v_scanf.c
CFILES += src/lib/vsnprintf.c
CFILES += src/lib/vsprintf.c
CFILES += src/lib/vsscanf.c
CFILES += src/stubs/abort.c
CFILES += src/stubs/chdir.c
CFILES += src/stubs/chmod.c
CFILES += src/stubs/chroot.c
CFILES += src/stubs/dup2.c
CFILES += src/stubs/dup.c
CFILES += src/stubs/env.c
CFILES += src/stubs/fchdir.c
CFILES += src/stubs/fchown.c
CFILES += src/stubs/fstat64.c
CFILES += src/stubs/ftruncate64.c
CFILES += src/stubs/getgrnam.c
CFILES += src/stubs/getopt.c
CFILES += src/stubs/getpid.c
CFILES += src/stubs/getpwuid.c
CFILES += src/stubs/lstat64.c
CFILES += src/stubs/open64.c
CFILES += src/stubs/pclose.c
CFILES += src/stubs/popen.c
CFILES += src/stubs/ptsname.c
CFILES += src/stubs/readdir64.c
CFILES += src/stubs/readlink.c
CFILES += src/stubs/signal.c
CFILES += src/stubs/symlink.c
CFILES += src/stubs/umask.c
CFILES += src/stubs/unlockpt.c
CFILES += src/stubs/utime.c
CFILES += src/syscall/access.c
CFILES += src/syscall/calloc.c
CFILES += src/syscall/__clear_cache.c
CFILES += src/syscall/clock.c
CFILES += src/syscall/close.c
CFILES += src/syscall/environment.c
CFILES += src/syscall/free.c
CFILES += src/syscall/fstat.c
CFILES += src/syscall/ftruncate.c
CFILES += src/syscall/gettimeofday.c
CFILES += src/syscall/isatty.c
CFILES += src/syscall/jmp.c
CFILES += src/syscall/lseek.c
CFILES += src/syscall/malloc.c
CFILES += src/syscall/mkdir.c
CFILES += src/syscall/mmap.c
CFILES += src/syscall/munmap.c
CFILES += src/syscall/open.c
CFILES += src/syscall/read.c
CFILES += src/syscall/realloc.c
CFILES += src/syscall/rename.c
CFILES += src/syscall/rmdir.c
CFILES += src/syscall/time.c
CFILES += src/syscall/truncate.c
CFILES += src/syscall/unlink.c
CFILES += src/syscall/write.c
CFILES += src/wchar/mbrtowc.c
CFILES += src/wchar/mbsrtowcs.c
CFILES += src/wchar/mbstowcs.c
CFILES += src/wchar/wchar.c
CFILES += src/wchar/wcscat.c
CFILES += src/wchar/wcschr.c
CFILES += src/wchar/wcscmp.c
CFILES += src/wchar/wcscpy.c
CFILES += src/wchar/wcslen.c
CFILES += src/wchar/wcsncat.c
CFILES += src/wchar/wcsncmp.c
CFILES += src/wchar/wcsncpy.c
CFILES += src/wchar/wcspbrk.c
CFILES += src/wchar/wcsrchr.c
CFILES += src/wchar/wcsstr.c

SIEDEV_DIR=../..
include $(SIEDEV_DIR)/rules.mk

install:
	cp -v $(PROJECT).so ../../lib/$(PROJECT).so
